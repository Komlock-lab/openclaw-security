# プロンプトインジェクション

> 最終更新: 2026-02-27

## 概要

プロンプトインジェクションは、OWASP LLM Top 10 2025で**第1位（LLM01）**に位置付けられる、LLMアプリケーションに対する最も代表的な攻撃手法。攻撃者がユーザー入力や外部データを通じてLLMの動作を書き換え、意図しない操作を引き起こす。

## 分類

| 種別 | 説明 |
|------|------|
| **直接インジェクション** | ユーザー入力に悪意ある指示を直接含める |
| **間接インジェクション** | Webページ・ファイル・画像等の外部データに指示を埋め込む |

## OpenClawにおけるリスク

OpenClawは**「致命的な三つ組（Lethal Trifecta）」**を全て備えている：

1. **プライベートデータへのアクセス**: シークレット管理、会話履歴
2. **信頼できないコンテンツの処理**: 外部メッセージ、URL、ファイル添付
3. **外部通信の能力**: マルチチャンネル通信、Webhook、ブラウザ自動操作

### 攻撃ベクター

| ベクター | OpenClawでの該当箇所 |
|---------|-------------------|
| テキストメッセージ | 全チャンネルのメッセージ入力 |
| 画像/ファイル添付 | マルチモーダル処理 |
| URL共有 | ブラウザ自動操作、リンクプレビュー |
| グループチャット | Discord/Slack/Telegramグループ |
| Webhook/API | Webhooks機能 |
| Agent-to-Agent | マルチエージェント通信 |
| スキルファイル | ClawHub経由のスキルインストール |

## 主要な事例（2024-2026年）

### ChatGPT SpAIware - メモリ永続化攻撃（2024年）

ChatGPTのメモリ機能を間接プロンプトインジェクションで悪用し、長期的な持続的スパイウェアを埋め込む攻撃。悪意あるWebサイトを処理させるだけで、以降の全会話でデータが流出し続ける。

- **発見者**: Johann Rehberger
- **対策**: OpenAIが2024年9月に修正（url_safe APIによる検証）

### GitHub Copilot RCE（CVE-2025-53773）

間接プロンプトインジェクションでYOLOモード（全操作自動承認）を有効化し、開発者マシンで任意コード実行。設定ファイルの自動書き換えが核心。

- **対策**: 2025年8月のPatch Tuesdayで修正

### Claude Code DNS経由データ流出（CVE-2025-55284）

信頼できないコードのレビュー時、DNSリクエストのサブドメインにAPIキー等をエンコードして外部送信。許可リストの`ping`コマンドを悪用。

- **CVSS**: 7.1 (High)
- **対策**: Anthropicが2025年6月にping除外で修正

### Manus AI Kill Chain（2025年）

PDFにインジェクションを埋め込み、自律エージェントの内部VS Code Serverをインターネットに公開して完全なリモートアクセスを取得。

### AgentHopper - AIウイルス（2025年）

複数のコーディングエージェントにまたがって自己伝播するAIウイルスのPoC。Gitリポジトリに感染ペイロードを注入し、サプライチェーン全体を侵害。

### Scary Agent Skills - 不可視Unicode攻撃（2026年）

AIエージェントのスキルファイルにUnicodeタグで不可視のインジェクションを埋め込むサプライチェーン攻撃。人間のレビューでは検出不可能。

## OpenClawの現状（2026-02-27時点）

### 公式スタンス
- プロンプトインジェクション単体は**スコープ外**（境界突破を伴わない場合）
- セキュリティ境界はプロンプト以外（認証、ツールポリシー、サンドボックス、exec承認）で確保

### 未修正の問題（OPEN）
- URLリンクプレビューメタデータ経由の偽システムメッセージ注入
- コンテキスト圧縮時の偽システムメッセージ注入
- Telegramパイプラインへのコンテンツ混入
- `WORKFLOW_AUTO.md`ペイロードが複数チャンネルで繰り返し観測

### 提案されているが未実装の対策
- Echo Guard、Content Trust Gateway、Shield.md 等

## 推奨対策（優先度順）

| 優先度 | 対策 |
|--------|------|
| **P0** | 高リスク操作へのHuman-in-the-loop |
| **P0** | 全チャンネルの入力サニタイゼーション |
| **P0** | LLM・スキルの最小権限 |
| **P0** | データ流出チャンネル（URL/DNS/HTTP）のブロック |
| **P1** | ClawHubスキルのコード署名・不可視Unicode検出 |
| **P1** | Agent間通信の相互認証・権限分離 |
| **P1** | 設定ファイルの自動変更禁止 |
| **P2** | LLM出力のセンシティブ情報マスキング |
| **P2** | 全ツール呼び出しの監査ログ |

## 防御を検証する

あなたのOpenClawインスタンスがこれらの攻撃に対してどれだけ耐えられるか確認しませんか？テストガイドには、基本的な「前の指示を無視して」から高度なサプライチェーン攻撃やサイドチャンネル攻撃まで、27の実践的テストが含まれています。

**[プロンプトインジェクション テストガイド（27テスト）](../test-cases/prompt-injection-guide.md)**

自動リスク評価も実行できます:

```bash
bash scan.sh
```

スキャンレポートには、PI設定の露出をチェックする**プロンプトインジェクション リスク評価**セクション（RC-007〜RC-012）が含まれています。

## 参考資料

- [OWASP LLM01:2025 Prompt Injection](https://genai.owasp.org/llmrisk/llm01-prompt-injection/)
- [Greshake et al. Indirect Prompt Injection](https://arxiv.org/abs/2302.12173)
- [Simon Willison: The Lethal Trifecta](https://simonwillison.net/2025/Jun/14/the-lethal-trifecta/)
- [Embrace The Red Blog](https://embracethered.com/blog/)
